---
- name: Ensure required common_tools variables are provided
  ansible.builtin.assert:
    that:
      - common_tools_packages is defined
      - common_tools_packages | length > 0
    fail_msg: >-
      Define required common_tools_packages before applying this role.
  tags: [common_tools]

- name: Gather installed packages
  ansible.builtin.package_facts:
    manager: auto
  tags: [common_tools]

- name: Install common tools
  ansible.builtin.apt:
    name: "{{ common_tools_packages }}"
    state: present
  vars:
    common_tools_missing: >-
      {{ common_tools_packages | difference(ansible_facts.packages.keys()
      | list) }}
  when: common_tools_missing | length > 0
  tags: [common_tools]
